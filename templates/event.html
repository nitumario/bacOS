<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Event - {{ event_data.nume }}</title>
    <style>
        /* Styling for overlay and container */
        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
            z-index: 1000; /* Higher than most elements */
        }

        #edit-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            z-index: 1001; /* Above overlay */
            max-width: 600px;
            width: 80%;
        }
    </style>
</head>
<body>
    <h1>Edit Event</h1>
    <form id="edit-event-form" action="{{ url_for('edit_event', id=event_data.id) }}" method="post">
        <p><strong>ID:</strong> {{ event_data.id }}</p>
        <p>
            <label for="nume">Name:</label>
            <input type="text" id="nume" name="nume" value="{{ event_data.nume }}">
        </p>
        <p>
            <label for="startdatetime">Start Date and Time:</label>
            <input type="datetime-local" id="startdatetime" name="startdatetime" value="{{ event_data.startdatetime|datetimeformat }}">
        </p>
        <p>
            <label for="durata">Duration:</label>
            <input type="number" id="durata" name="durata" value="{{ event_data.durata }}">
        </p>
        <p>
            <label for="compiler">Compiler:</label>
            <input type="checkbox" id="compiler" name="compiler" {% if event_data.compiler %}checked{% endif %}>
        </p>
        <h2>Subjects</h2>
        <ul>
            {% for subiect in event_data.subiecte %}
                <li>{{ subiect }}</li>
            {% endfor %}
        </ul>
        <p>
            <input type="submit" value="Save Changes">
        </p>
    </form>

    <!-- Button to open edit form in a container -->
    <button id="open-edit-form">Edit Event</button>

    <!-- Container for displaying the edit form -->
    <div id="overlay"></div>
    <div id="edit-container"></div>

    <!-- jQuery CDN (you can use a local copy if preferred) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
        $(document).ready(function() {
            // Handle click on "Edit Event" button
            $('#open-edit-form').click(function() {
                var currentId = {{ event_data.id }};
                var url = '/gentest/' + currentId;

                // AJAX request to fetch the edit form
                $.ajax({
                    url: url,
                    type: 'GET',
                    success: function(response) {
                        // On success, display the form in the container
                        $('#edit-container').html(response);
                        $('#overlay').fadeIn();
                        $('#edit-container').fadeIn();
                        attachFormSubmitHandler();
                    },
                    error: function(xhr, status, error) {
                        console.error('Error fetching edit form:', error);
                    }
                });
            });

            // Close the container when clicking on overlay
            $('#overlay').click(function() {
                $('#overlay').fadeOut();
                $('#edit-container').fadeOut();
            });

            // Function to attach form submit handler
            function attachFormSubmitHandler() {
                $('#edit-event-form').submit(function(event) {
                    event.preventDefault(); // Prevent the default form submission

                    var formData = $(this).serialize(); // Serialize the form data

                    console.log('Submitting form via AJAX:', formData);

                    $.ajax({
                        url: $(this).attr('action'),
                        type: 'POST',
                        data: formData,
                        success: function(response) {
                            // Handle successful response (e.g., show a message or update part of the page)
                            alert('Event updated successfully!');
                            $('#overlay').fadeOut();
                            $('#edit-container').fadeOut();
                        },
                        error: function(xhr, status, error) {
                            // Handle error response
                            console.error('Error submitting form:', error);
                        }
                    });
                });
            }

            // Initial call to ensure handler is attached if the form is already in the DOM
            attachFormSubmitHandler();
        });
    </script>
</body>
</html>
